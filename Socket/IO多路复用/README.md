# IO多路复用

## Socket多线程操作

在Socket通信中，服务端有两类文件描述符，一个用于监听的，N个用于通信的

监听描述符的读缓冲区会等待客户端的connect请求，accept检测到读缓冲区有数据就会读出数据建立连接，否则一直阻塞

通信描述符的读缓冲区会等待客户端的send或者write请求，read或recv检测到读缓冲区有数据就会读出来，否则一直阻塞

通信描述符的写缓冲区，write或send操作，当写缓冲区有位置时，就写入并发送给客户端，否则阻塞

客户端的读写缓冲区操作类似

如果只有单线程，那么上述的阻塞会相互影响，read阻塞了就无法write或accept，于是有了多线程的Socket

## IO多路复用技术

IO多路复用：把检测文件描述符的读写缓冲区的操作交给内核，系统不必创建进程/线程，降低了系统开销

有select、poll、epoll三种函数

select 和 poll 的逻辑：    
将需要检测的文件描述符线性表拷贝给内核，内核线性检测这些描述符后，拷贝给用户。   
关键字：线性表、线程检测、拷贝。就能看出这两函数有效率问题，处理大规模流量不适用   

epoll 逻辑：   
基于红黑树来管理待检测集合，使用回调机制，效率高。epoll中内核和用户区使用共享内存，省去不必要的拷贝   
关键字：红黑树、回调机制、共享内存。是select、poll的升级版   

select支持跨平台：Linux、Windows、MAC   
poll、epoll仅支持Linux
