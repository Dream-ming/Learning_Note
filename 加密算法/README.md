# 加密算法

## MD4、MD5

### 1、特点

* 本质上是 hash 映射，不是加密算法
* 在如今的算力下，都不再安全，在安全敏感的场景下，不推荐使用

### 2、流程

* 输入一个字符串
* 将字符串补全到长度为 512 位的整数倍，将每 512 位分开处理
* 通过预设变量循环压缩
  * MD4 的变量：A=67452301，B=efcdab89，C=98badcfe，D=10325476
  * MD5 的变量：A=01234567，B=89abcdef，C=fedcba98，D=76543210
* 输出 16 个字节的内容

## SHA

### 1、特点

* 本质上只是一种 hash 映射，不是加密算法
* SHA - 1 在 2017 年被发现哈希冲突，不再认为是安全的
* SHA - 2 系列，SHA - 256 目前认为安全，被广泛使用
* SHA - 3 系列，暂未普及，旨在于对抗量子计算的攻击
* 输出长度固定

### 2、流程

* 输入一个字符串
* 将字符串补全到长度为 512 位 的整数倍
* 输出 32 个字节，256 位的字符串，十六进制下有 64 个字符

## AES

### 1、特点

* 对称加密，加解密过程的密钥相同，过程互逆
* 速度快，可处理长字符串

### 2、流程（ CBC模式，128位密钥）

* 初始数据：明文，密钥，初始化向量
* 加密
  * 1、将明文转换位 16 字节的块，长了切割，短了补齐
  * 2、第一块明文与初始化向量异或，异或结果与 AES 密钥加密
  * 3、AES加密步骤解析
    * 将每个字节替换为 S-Box 表中对应的值（非线性替换）
    * 行位移操作
    * 列混合操作
    * 与当前轮的密钥异或（当前轮的密钥通过 初始密钥 和 矩阵 计算得出）
    * 重复上述步骤 10 轮

  * 4、AES 加密后得到一块密文
  * 5、将上一块数据的密文，当作当前明文的初始化向量，重复上述

* 解密
  * 使用 AES 密钥对所有密文块解密，得到中间值
  * 第一个密文块与初始向量异或，得到明文。其他密文块与前一块明文异或，得到明文

* 其他
  * AES 需要初始化向量的模式有 CBC、CFB、OFB、CTR，不需要的有ECB
  * 初始化向量的作用是，对第一块内容加密，然后使用第一块密文对第二块明文加密，这样可以使相同的输入得到不同的输出，十分的安全



## RSA

### 1、特点

* 非对称加密，公钥可发放，不影响私钥的安全性

### 2、流程

* 生成密钥
  * 选择两个大指数 p 和 q，要求足够大且不同，通常长度不小于1024
  * 计算 n = p * q，这里 n 的长度决定加密的强度
  * 计算欧拉函数 $ \phi {(n)} $ = (p - 1) * (q - 1)
  * 选择公钥指数 e，要求小于 $ \phi {(n)} $ ，但与 $ \phi {(n)} $ 互质。通常用 65537
  * 计算私钥指数 d，要求 $ d * e \equiv 1 $ mod $\phi(n) $
* 加密
  * 密文 C，文明 M，公钥 (n, e)
  * $C = M ^ e $ mod n​
* 解密
  * 私钥 (n, d)
  * $M = C ^ d $ mod n
* 加解密证明
  * $ C = M ^ e $ mod n
  * $M = C^d$ mod n
  * M = $(M^e)^d$ mod n = $M ^ {e*d} $ mod n = $M ^ 1$ mod n 
    * 第三个等号涉及到数论中的 **模幂运算性质**、**欧拉定理**、**中国剩余定理**， 看不明白
  * 简单地说就是：d 和 e 在模和幂上有一定的关系，可以相互解密